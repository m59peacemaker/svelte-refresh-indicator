<div class="refresh-indicator">
  {{#if spinning}}
    <div class="arrow-sync-container" style="transform: rotate({{ arrowSyncRotate }}deg);">
      <Spinner/>
    </div>
  {{else}}
    <Arrow progressRatio="{{ progressRatio }}"></Arrow>
  {{/if}}
</div>

<script>
import Arrow from './Arrow.html'
import Spinner from './Spinner.html'

export default {
  data () {
    return {
      progressRatio: undefined,
      lastProgressRatio: 0
    }
  },

  computed: {
    spinning: progressRatio => progressRatio === undefined,
    arrowSyncRotate: (spinning, lastProgressRatio) => {
      const ratio = !spinning ? 0 : (lastProgressRatio || 0)
      return ratio * 315
    }
  },

  oncreate () {
    this.observe('progressRatio', (newValue, oldValue) => this.set({ lastProgressRatio: oldValue }))
  },

  components: {
    Arrow,
    Spinner
  }
}
</script>

<style>

.refresh-indicator {
  width: 26px;
  height: 26px;
  padding: 9px;
  border-radius: 50%;
  background-color: #fff;
  box-shadow: 0 2px 10px 0 rgba(0, 0, 0, 0.3);
}

.arrow-sync-container {
  height: 100%;
}

</style>
